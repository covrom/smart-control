# Smart-Control

Smart-Control — это комплексное решение для мониторинга состояния дисковых устройств и управления ими через Telegram-бота. Оно включает в себя серверное приложение, которое обрабатывает данные от агентов, и агентские приложения для Linux и Windows, которые собирают информацию о дисках и отправляют её на сервер. Сервер использует LLM для описания состояния дисков и выдачи рекомендаций, и сообщает их пользователю через бота Telegram.

## Описание компонентов

### Серверное приложение
Серверное приложение отвечает за:
- Прием данных от агентов
- Обработку и хранение информации о состоянии дисков
- Взаимодействие с Telegram-ботом для отправки уведомлений
- Управление задачами и cron-расписаниями
- Интеграцию с LLM для анализа данных SMART:
  - любые публичные OpenAI API (например, openrouter)
  - локальные модели Ollama (https://docs.ollama.com/api/openai-compatibility)
  - локальные модели Llama.cpp

### Агентское приложение для Linux (docker контейнер)
Агентское приложение для Linux собирает информацию о дисках и отправляет её на сервер:
- Сбор данных SMART с дисков (с помощью smartctl)
- Отправка данных через Telegram-бота
- Работа в фоновом режиме
- Автоматическое обновление информации
- Поддержка различных дисковых устройств

### Агентское приложение для Windows
Агентское приложение для Windows также собирает информацию о дисках и отправляет её на сервер:
- Сбор данных SMART с дисков (с помощью smartctl для windows)
- Отправка данных через Telegram-бота
- Работа как Windows-служба
- Автоматическое обновление информации
- Поддержка различных дисковых устройств

## Установка

### Установка сервера
Для установки сервера выполните скрипт:
```bash
./deploy-server-example.sh
```

### Установка агента для Linux
Для установки агента для Linux выполните скрипт:
```bash
./deploy-agent-example.sh
```

### Установка агента для Windows
Для сборки дистрибутива агента для Windows выполните скрипт:
```bash
./build-winsvc.sh
```

## Переменные окружения

Перед установкой необходимо изменить следующие переменные окружения в соответствующих файлах:

- `deploy-server-example.sh` — переменные для сервера
- `deploy-agent-example.sh` — переменные для агента Linux

### Переменные окружения для сервера

- `OPENAI_BASE_URL` — URL-адрес API OpenAI (например, `http://192.168.1.1:8080/v1`)
- `OPENAI_API_KEY` — API-ключ OpenAI
- `OPENAI_MODEL` — используемая модель OpenAI (например, `qwen3-30b-a3b-instruct-2507`)
- `TELEGRAM_BOT_TOKEN` — токен Telegram-бота
- `TELEGRAM_CHAT_ID` — ID чата Telegram (число)

### Переменные окружения для **агента** в docker контейнере

- `HTTP_AUTH_TOKEN` — токен аутентификации между агентами и сервером
- `SMART_HOSTNAME` — имя агента
- `COLLECTOR_URL` — URL-адрес для отправки данных от агента на сервер (например, `http://smart-control:8000/smart/report`)
- `CRON_SCHEDULE` — расписание cron для запуска задач (например, `"55 23 * * *"`)

### Настройка агента Windows

Производится во время установки дистрибутива, на соответствующей странице установщика.

## Структура проекта

- `cmd/tgsmctl/` — точка входа для серверного приложения
- `internal/api/` — HTTP API сервера
- `internal/cron/` — реализация cron-задач
- `internal/disk/` — сбор данных SMART
- `internal/llmdesc/` — интеграция с LLM для описания состояния дисков
- `internal/smartdata/` — обработка данных SMART
- `win/` — агент для Windows
- `docker-compose.yml` — docker-compose для запуска сервера
- `docker-compose.agent.yml` — docker-compose для запуска агента Linux
- `deploy-server-example.sh` — скрипт разворачивания сервера
- `deploy-agent-example.sh` — скрипт разворачивания агента Linux
- `build-winsvc.sh` — скрипт сборки Windows-агента

## Требования

- Docker
- Docker Compose
- Telegram-бот для отправки уведомлений
- OpenAI API ключ для анализа данных SMART

## Пример использования

1. Создайте Telegram-бота и получите токен
2. Настройте переменные окружения в `deploy-server-example.sh` и `deploy-agent-example.sh`
3. Запустите сервер: `./deploy-server-example.sh`
4. Запустите агент: `./deploy-agent-example.sh` или соберите Windows-агент с помощью `./build-winsvc.sh`
5. Наблюдайте за уведомлениями в Telegram-чате

## Лицензия

Этот проект распространяется по лицензии MIT. Подробности смотрите в файле [LICENSE](LICENSE).
